{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/common.css' %}" />
{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1 class="page-title">
            📋 Task Details - Room {{ task.room.room_number }}
        </h1>
        <div style="display: flex; gap: 10px;">
            <a href="{% url 'housekeeping-task-update' task.id %}" class="btn btn-warning">
                ✏️ Edit Task
            </a>
            {% if task.task_status != 'COMPLETED' %}
            <a href="{% url 'housekeeping-task-update-status' task.id %}" class="btn btn-success">
                🔄 Update Status
            </a>
            {% endif %}
            <a href="{% url 'housekeeping-task-list' %}" class="btn btn-secondary">
                ← Back to Tasks
            </a>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
        <!-- Main Information -->
        <div class="card">
            <div class="card-body">
                <h3 style="color: #667eea; margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                    📋 Task Information
                </h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <div>
                        <label style="display: block; font-weight: bold; color: #333; margin-bottom: 5px;">Room:</label>
                        <p style="margin: 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                            <strong>Room {{ task.room.room_number }}</strong> ({{ task.room.room_type }})
                            {% if task.status %}
                            <br><small style="color: {{ task.status.color_code }};">{{ task.status.display_name }}</small>
                            {% endif %}
                        </p>
                    </div>
                    <div>
                        <label style="display: block; font-weight: bold; color: #333; margin-bottom: 5px;">Task Type:</label>
                        <p style="margin: 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">{{ task.get_task_type_display }}</p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <div>
                        <label style="display: block; font-weight: bold; color: #333; margin-bottom: 5px;">Status:</label>
                        <p style="margin: 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                            <span class="status-badge status-{{ task.task_status|lower }}">
                                {{ task.get_task_status_display }}
                            </span>
                        </p>
                    </div>
                    <div>
                        <label style="display: block; font-weight: bold; color: #333; margin-bottom: 5px;">Priority:</label>
                        <p style="margin: 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                            <span class="status-badge" style="background: 
                                {% if task.priority == 'URGENT' %}#dc3545{% elif task.priority == 'HIGH' %}#fd7e14{% elif task.priority == 'MEDIUM' %}#ffc107{% else %}#28a745{% endif %}20; 
                                color: {% if task.priority == 'URGENT' %}#dc3545{% elif task.priority == 'HIGH' %}#fd7e14{% elif task.priority == 'MEDIUM' %}#ffc107{% else %}#28a745{% endif %};">
                                {{ task.get_priority_display }}
                            </span>
                        </p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <div>
                        <label style="display: block; font-weight: bold; color: #333; margin-bottom: 5px;">Assigned To:</label>
                        <p style="margin: 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">{{ task.assigned_to|default:"Not assigned" }}</p>
                    </div>
                    <div>
                        <label style="display: block; font-weight: bold; color: #333; margin-bottom: 5px;">Estimated Duration:</label>
                        <p style="margin: 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">{{ task.duration_display }}</p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <div>
                        <label style="display: block; font-weight: bold; color: #333; margin-bottom: 5px;">Scheduled Date:</label>
                        <p style="margin: 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                            {{ task.scheduled_date|date:"M d, Y" }}
                            {% if task.is_overdue %}
                                <br><small style="color: #dc3545;">⚠️ Overdue</small>
                            {% endif %}
                        </p>
                    </div>
                    <div>
                        <label style="display: block; font-weight: bold; color: #333; margin-bottom: 5px;">Scheduled Time:</label>
                        <p style="margin: 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">{{ task.scheduled_time|default:"Not specified" }}</p>
                    </div>
                </div>

                {% if task.description %}
                <div style="margin-bottom: 25px;">
                    <label style="display: block; font-weight: bold; color: #333; margin-bottom: 5px;">Description:</label>
                    <p style="margin: 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">{{ task.description }}</p>
                </div>
                {% endif %}

                {% if task.notes %}
                <div style="margin-bottom: 25px;">
                    <label style="display: block; font-weight: bold; color: #333; margin-bottom: 5px;">Notes:</label>
                    <p style="margin: 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">{{ task.notes }}</p>
                </div>
                {% endif %}

                {% if inspections %}
                <h3 style="color: #667eea; margin: 30px 0 20px 0; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                    🔍 Related Inspections
                </h3>

                <div style="max-height: 300px; overflow-y: auto;">
                    {% for inspection in inspections %}
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee;">
                        <div>
                            <div style="font-weight: 600; color: #333;">{{ inspection.inspection_date|date:"M d, Y" }} - {{ inspection.inspector_name }}</div>
                            <div style="font-size: 12px; color: #666;">
                                {{ inspection.inspection_time|default:"Time not specified" }}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <span class="status-badge status-{{ inspection.inspection_status|lower }}">{{ inspection.get_inspection_status_display }}</span>
                            <br><a href="{% url 'housekeeping-inspection-detail' inspection.id %}" class="btn btn-info btn-sm" style="margin-top: 5px;">👁️ View</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Timeline & Statistics -->
        <div>
            <!-- Timeline -->
            <div class="card" style="margin-bottom: 20px;">
                <div class="card-body">
                    <h4 style="color: #333; margin-bottom: 15px;">🕒 Timeline</h4>
                    <div style="font-size: 14px; color: #666;">
                        <div style="margin-bottom: 10px;">
                            <strong>Created:</strong><br>
                            {{ task.created_at|date:"M d, Y g:i A" }}
                        </div>
                        {% if task.started_at %}
                        <div style="margin-bottom: 10px;">
                            <strong>Started:</strong><br>
                            {{ task.started_at|date:"M d, Y g:i A" }}
                        </div>
                        {% endif %}
                        {% if task.completed_at %}
                        <div style="margin-bottom: 10px;">
                            <strong>Completed:</strong><br>
                            {{ task.completed_at|date:"M d, Y g:i A" }}
                        </div>
                        {% endif %}
                        <div>
                            <strong>Last Updated:</strong><br>
                            {{ task.updated_at|date:"M d, Y g:i A" }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}